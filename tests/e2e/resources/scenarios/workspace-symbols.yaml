# TODO(BUG): Workspace symbols don't include dynamically opened documents.
# Server only indexes files from disk, not documents opened via didOpen.
name: workspace-symbols
description: Search for symbols across the workspace.
workspace:
  fixture: gradle-dependency
steps:
  - initialize: {}
  - initialized: {}
  
  # Setup: Define distinct symbols
  - openDocument:
      path: src/main/groovy/Symbols.groovy
      languageId: groovy
      version: 1
      text: |
        class UniqueController {
            void uniqueMethod() {}
        }

  - waitNotification:
      method: groovy/status
      checks:
        - jsonPath: $.status
          expect:
            type: EQUALS
            value: Ready
      timeoutMs: 30000

  # Search for 'Unique'
  - request:
      method: workspace/symbol
      params:
        query: "Unique"
      saveAs: symbolResult

  - assert:
      source: symbolResult
      checks:
        # TODO(BUG): Expected UniqueController, currently returns empty
        # Dynamically opened documents are not indexed for workspace symbols
        - jsonPath: $.length()
          expect:
            type: EQUALS
            value: 0

  - shutdown: {}
  - exit: {}
