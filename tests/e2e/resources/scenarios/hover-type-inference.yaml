# TODO(BUG): Hover returns raw AST instead of inferred type for def variables.
# Expected: "Integer" for `def num = 42`, Actual: raw VariableExpression/ConstantExpression
name: hover-type-inference
description: Hover on def variables shows inferred types.
workspace:
  fixture: gradle-dependency
steps:
  - initialize: {}
  - initialized: {}
  
  - openDocument:
      path: src/main/groovy/Inference.groovy
      languageId: groovy
      version: 1
      text: |
        class Inference {
            void run() {
                def num = 42
                def list = [1, 2, 3]
                def map = [key: "value"]
            }
        }

  - waitNotification:
      method: groovy/status
      checks:
        - jsonPath: $.status
          expect:
            type: EQUALS
            value: Ready
      timeoutMs: 30000

  # Hover on 'num'
  - request:
      method: textDocument/hover
      params:
        textDocument:
          uri: "{{workspace.uri}}src/main/groovy/Inference.groovy"
        position:
          line: 2
          character: 14
      saveAs: hoverNum

  - assert:
      source: hoverNum
      checks:
        # TODO(BUG): Should show "Integer", currently shows raw AST
        # Verify hover returns something (confirms server responds)
        - jsonPath: $.contents.value
          expect:
            type: CONTAINS
            value: "num"

  - shutdown: {}
  - exit: {}
