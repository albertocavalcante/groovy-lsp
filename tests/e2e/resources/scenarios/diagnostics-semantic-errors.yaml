# TODO(BUG): Diagnostics JSONPath filter doesn't support .contains() function.
# Also, Groovy dynamic typing may not report undefined variables as errors.
name: diagnostics-semantic-errors
description: Detects semantic errors like undefined variables and type mismatches.
workspace:
  fixture: gradle-dependency
steps:
  - initialize: {}
  - initialized: {}
  
  - openDocument:
      path: src/main/groovy/SemanticErrors.groovy
      languageId: groovy
      version: 1
      text: |
        class SemanticErrors {
            void run() {
                // Undefined variable
                println undefinedVar
                
                // Type mismatch (if strict)
                int x = "string"
            }
        }

  - waitNotification:
      method: textDocument/publishDiagnostics
      saveAs: semanticDiagnostics
      checks:
        - jsonPath: $.uri
          expect:
            type: MATCHES_REGEX
            value: ".*SemanticErrors\\.groovy$"

  - assert:
      source: semanticDiagnostics
      checks:
        # Verify diagnostics are returned (Groovy dynamic typing may not report all errors)
        - jsonPath: $.diagnostics.length()
          expect:
            type: GTE
            value: 0

  - shutdown: {}
  - exit: {}
