# .envrc
# Load SDKMAN environment if available
# Locate SDKMAN (Default or Homebrew)
if [ -z "$SDKMAN_DIR" ]; then
    if [ -d "$HOME/.sdkman" ]; then
        SDKMAN_DIR="$HOME/.sdkman"
    elif command -v brew >/dev/null && [ -d "$(brew --prefix sdkman-cli 2>/dev/null)/libexec" ]; then
        SDKMAN_DIR="$(brew --prefix sdkman-cli)/libexec"
    fi
fi

# Load SDKMAN environment if available
if [ -s ".sdkmanrc" ] && [ -n "$SDKMAN_DIR" ]; then
    JAVA_VERSION=$(grep "java=" .sdkmanrc | cut -d= -f2)
    if [ -n "$JAVA_VERSION" ]; then
        candidate_home="$SDKMAN_DIR/candidates/java/$JAVA_VERSION"
        if [ -d "$candidate_home" ]; then
           export JAVA_HOME="$candidate_home"
           # Use direnv's PATH_add helper
           PATH_add "$JAVA_HOME/bin"
           echo "☕️ Activated SDKMAN Java $JAVA_VERSION from $candidate_home"
        else
           echo "⚠️ Java $JAVA_VERSION not found at $candidate_home. Please run './tools/macos/setup.sh'."
        fi
    fi
fi
